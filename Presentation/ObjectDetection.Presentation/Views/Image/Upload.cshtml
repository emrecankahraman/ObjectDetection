@model ObjectDetection.Presentation.Models.ImageUploadViewModel

@{
    ViewData["Title"] = "Image Upload";
}

<style>
    body {
        font-family: Arial, sans-serif;
        display: flex;
    }

    .sidebar {
        width: 200px;
        margin-right: 20px;
    }

        .sidebar h3 {
            margin-top: 0;
            color: #2c3e50;
        }

        .sidebar img {
            width: 100%;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

    .main-content {
        flex: 1;
    }

    form {
        background-color: #f9f9f9;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        width: 400px;
        margin-bottom: 30px;
    }

    input[type="file"] {
        margin-bottom: 15px;
        display: block;
    }

    button {
        padding: 8px 16px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

        button:hover {
            background-color: #2980b9;
        }

    .image-preview {
        margin-top: 20px;
    }

        .image-preview img {
            max-width: 500px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

    .result-list {
        list-style-type: none;
        padding-left: 0;
    }

        .result-list li {
            padding: 10px;
            background-color: #ecf0f1;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .result-list strong {
            color: #2c3e50;
        }
</style>

<div class="sidebar">
    @if (Model.UserImages != null && Model.UserImages.Any())
    {
        <h3>Yüklediğiniz Fotoğraflar</h3>
        @foreach (var img in Model.UserImages)
        {
            <img src="@img.Path" alt="@img.FileName" />
        }
    }
</div>

<div class="main-content">
    <h2>Upload Image for Detection</h2>

    <!-- ✅ Arama formu -->
    <form asp-controller="Image" asp-action="Search" method="get" style="margin-bottom: 20px;">
        <input type="text" name="query" value="@Model.SearchQuery" placeholder="örn. beyaz araba, kedi, tekirdağ" />
        <button type="submit">Ara</button>
    </form>

    <!-- ✅ Upload Formu -->
    <form asp-action="Upload" asp-controller="Image" method="post" enctype="multipart/form-data">
        <input type="file" name="ImageFile" />
        <button type="submit">Analyze</button>
    </form>

    @if (Model.UploadedImagePath != null)
    {
        <div class="image-preview">
            <h3>Uploaded Image:</h3>
            <img src="@Model.UploadedImagePath" alt="Uploaded Image" />
        </div>
    }

    @if (Model.Results != null && Model.Results.Any())
    {
        <h3>Detection Results:</h3>
        <ul class="result-list">
            @foreach (var result in Model.Results)
            {
                var rgb = result.DominantColorRgb != null && result.DominantColorRgb.Count == 3
                ? $"rgb({result.DominantColorRgb[0]}, {result.DominantColorRgb[1]}, {result.DominantColorRgb[2]})"
                : "gray";

                <li>
                    <strong>@result.Class</strong> — Score: @result.Score
                    | Color: <span style="color:@rgb">@result.ColorName</span>
                </li>
            }
        </ul>
    }

    <!-- ✅ Arama Sonuçları -->
    @if (Model.SearchResults != null && Model.SearchResults.Any())
    {
        <h3>Arama Sonuçları:</h3>
        <ul class="result-list">
            @foreach (var item in Model.SearchResults)
            {
                <li>
                    <strong>@item.FileName</strong><br />
                    Etiketler: @string.Join(", ", item.Labels)<br />
                    Renkler: @string.Join(", ", item.Colors)<br />
                    Şehir: @item.City
                    <br />
                    <img src="@item.Path" style="max-width:150px; margin-top:5px;" />
                </li>
            }
        </ul>
    }
</div>
